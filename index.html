<!DOCTYPE html>
<html>
<head>
    <title>Générateur de Vidéo</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        canvas { border: 1px solid #ccc; }
        button { margin: 10px; padding: 10px 20px; font-size: 16px; }
    </style>
</head>
<body>
    <h2>Générateur de Vidéo dans le Navigateur</h2>
    
    <canvas id="canvas" width="640" height="480"></canvas>
    <br>
    <button onclick="demarrerEnregistrement()">Démarrer l'enregistrement</button>
    <button onclick="arreterEnregistrement()">Arrêter et télécharger</button>
    <button onclick="ajouterImage()">Ajouter une image</button>
    <button onclick="ajouterTexte()">Ajouter du texte</button>
    
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let mediaRecorder;
        let enregistrementActif = false;
        let chunks = [];
        let compteurImages = 0;

        // Fonction pour dessiner sur le canvas
        function dessiner() {
            ctx.fillStyle = '#f0f0f0';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Dessiner un rectangle animé
            ctx.fillStyle = 'blue';
            ctx.fillRect(compteurImages % 500, 200, 100, 100);
            
            // Ajouter du texte
            ctx.fillStyle = 'black';
            ctx.font = '20px Arial';
            ctx.fillText(`Frame: ${compteurImages}`, 10, 30);
            
            compteurImages++;
        }

        // Animation continue
        function animer() {
            dessiner();
            if (enregistrementActif) {
                requestAnimationFrame(animer);
            }
        }

        // Démarrer l'enregistrement
        async function demarrerEnregistrement() {
            const stream = canvas.captureStream(30); // 30 FPS
            mediaRecorder = new MediaRecorder(stream, {
                mimeType: 'video/webm'
            });

            chunks = [];
            
            mediaRecorder.ondataavailable = (e) => {
                if (e.data.size > 0) {
                    chunks.push(e.data);
                }
            };

            mediaRecorder.onstop = () => {
                const blob = new Blob(chunks, { type: 'video/webm' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `video_${Date.now()}.webm`;
                a.click();
            };

            mediaRecorder.start();
            enregistrementActif = true;
            animer();
            
            console.log('Enregistrement démarré');
        }

        // Arrêter l'enregistrement
        function arreterEnregistrement() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                enregistrementActif = false;
                console.log('Enregistrement arrêté');
            }
        }

        // Ajouter une image au canvas
        function ajouterImage() {
            const img = new Image();
            img.src = 'https://via.placeholder.com/200x150'; // URL de l'image
            img.onload = () => {
                ctx.drawImage(img, 400, 300, 200, 150);
            };
        }

        // Ajouter du texte
        function ajouterTexte() {
            const texte = prompt('Entrez le texte à ajouter :', 'Hello World!');
            if (texte) {
                ctx.fillStyle = 'red';
                ctx.font = '30px Arial';
                ctx.fillText(texte, 200, 400);
            }
        }

        // Démarrer l'animation automatiquement
        setInterval(() => {
            if (!enregistrementActif) {
                dessiner();
            }
        }, 33); // ~30 FPS
    </script>
</body>
</html>